machine:
        java:
                version: oraclejdk8
        services:
                - docker

dependencies:
        override:
                - echo Y | lein upgrade 2.5.1:
                    timeout: 900
                - lein version-spec
                - lein deps

        post:
                #- lein cljx once
                - lein cljsbuild once
test:
        override: 
                - lein test:
                    timeout: 1800
                # TODO: make this happen as build task
                - lein clean && lein with-profile uberjar cljsbuild once app && lein with-profile uberjar uberjar
                - docker build -t onyx/onyx-dashboard:$CIRCLE_SHA1 . | tee docker-build.log
                - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
                - docker push onyx/onyx-dashboard:$CIRCLE_SHA1
